# Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

### 1 .Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?
Один из вариантов в linux - команда `ip`
``` commandline
vagrant@front:~$ ip -br link
lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP> 
eth0             UP             08:00:27:14:86:db <BROADCAST,MULTICAST,UP,LOWER_UP> 
eth1             UP             08:00:27:d7:55:27 <BROADCAST,MULTICAST,UP,LOWER_UP> 

```
В системах Windows  использовал команду `ipconfig /all`:
```commandline
C:\Users\nedago>ipconfig /all

Настройка протокола IP для Windows

   Имя компьютера  . . . . . . . . . : DESKTOP-87HSS9Q
   Основной DNS-суффикс  . . . . . . :
   Тип узла. . . . . . . . . . . . . : Гибридный
   IP-маршрутизация включена . . . . : Нет
   WINS-прокси включен . . . . . . . : Нет

Адаптер Ethernet Ethernet:

   Состояние среды. . . . . . . . : Среда передачи недоступна.
   DNS-суффикс подключения . . . . . :
   Описание. . . . . . . . . . . . . : Realtek PCIe GbE Family Controller
   Физический адрес. . . . . . . . . : 1C-1B-0D-4E-F6-54
   DHCP включен. . . . . . . . . . . : Да
   Автонастройка включена. . . . . . : Да


Адаптер беспроводной локальной сети Беспроводная сеть 2:

   DNS-суффикс подключения . . . . . :
   Описание. . . . . . . . . . . . . : Сетевая карта беспроводных сетей 802.11bg PCI-E Realtek RTL8192CE ДЛЯ РОССИИ
   Физический адрес. . . . . . . . . : D0-37-45-04-29-3C
   DHCP включен. . . . . . . . . . . : Да
   Автонастройка включена. . . . . . : Да
   IPv6-адрес. . . . . . . . . . . . : 2a02:2168:a195:bd00:983c:b6e3:28e3:4911(Основной)
   Временный IPv6-адрес. . . . . . . : 2a02:2168:a195:bd00:40c7:f2c7:e14:ff97(Основной)
   Локальный IPv6-адрес канала . . . : fe80::983c:b6e3:28e3:4911%13(Основной)
   IPv4-адрес. . . . . . . . . . . . : 10.0.1.27(Основной)
   Маска подсети . . . . . . . . . . : 255.255.255.0
   Аренда получена. . . . . . . . . . : 13 декабря 2021 г. 10:15:36
   Срок аренды истекает. . . . . . . . . . : 14 декабря 2021 г. 10:15:35
   Основной шлюз. . . . . . . . . : fe80::bac7:5dff:fece:e91c%13
                                       10.0.1.1
   DHCP-сервер. . . . . . . . . . . : 10.0.1.1
   IAID DHCPv6 . . . . . . . . . . . : 214972229
   DUID клиента DHCPv6 . . . . . . . : 00-01-00-01-20-B7-D7-13-1C-1B-0D-4E-F6-54
   DNS-серверы. . . . . . . . . . . : 2a02:2168:a195:bd00:bac7:5dff:fece:e91c
                                       10.0.1.1
   NetBios через TCP/IP. . . . . . . . : Включен
```
### 2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?
> Link Layer Discovery Protocol (LLDP) — протокол канального уровня, который позволяет сетевым устройствам 
анонсировать в сеть информацию о себе и о своих возможностях, а также собирать эту информацию о соседних устройствах.

```commandline
vagrant@front:~$ sudo apt update
vagrant@front:~$ sudo apt install lldpd
vagrant@front:~$ sudo systemctl enable lldpd
Synchronizing state of lldpd.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable lldpd
vagrant@front:~$ sudo service lldpd start
vagrant@front:~$ lldpctl
-------------------------------------------------------------------------------
LLDP neighbors:
-------------------------------------------------------------------------------
vagrant@front:~$
```
Соседей с активированным протоколом LLDP нет.

### 3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.
> VLAN – это аббревиатура, означающая Virtual Local Area Network (виртаульная локальная сеть). На одном физическом порту может совместно существовать несколько VLAN-сетей, которые настраиваются программными средствами Linux, а не конфигурацией физических интерфейсов (но настройка самих интерфейсов тоже требуется). С помощью VLAN можно разделить сетевые ресурсы для использования различных сервисов.

[Настройки для разных linux](https://itproffi.ru/nastrojka-vlan-interfejsov-v-linux/)  
[Настройка для Ubuntu](https://wiki.ubuntu.com/vlan)
```commandline
vagrant@front:~$ sudo modprobe 8021q # Загружаем драйвер (модуль) ядра Linux под названием 8021
vagrant@front:~$ lsmod | grep 8021q # Проверяем его загрузку
8021q                  32768  0
garp                   16384  1 8021q
mrp                    20480  1 8021q
vagrant@front:~$ sudo apt-get install vlan
vagrant@front:~$ sudo ip link add link eth1 name eth1.10 type vlan id 10 #Создаем новый интерфейс на eth1 c VLAN id 10
vagrant@front:~$ sudo ip addr add 10.0.0.1/24 dev eth1.10 #Добавляем IP адрес из DMZ зоны на нвоый интерфейс eth1.10
vagrant@front:~$ sudo ip link set up eth1.10 #Запускаем новый интерфейс 

#Для нормальной работы после рестарта сервера делаем:
sudo su -c 'echo "8021q" >> /etc/modules' #Добавляем модуль в ядро для загрузки
# Правим файл с интерфейсами /etc/network/interfaces добавляя в него строки:
auto eth1.10
iface eth1.10 inet static
    address 10.0.0.1
    netmask 255.255.255.0
    vlan-raw-device eth1
```

### 4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.
[Агрегация каналов](https://wikiboard.ru/wiki/Link_aggregation): Параллельное использование нескольких сетевых 
подключений для увеличения емкости и надежности.  


Объединение сетевых интерфейсов(Bonding) – это механизм, используемый Linux-серверами и предполагающий связь 
нескольких физических интерфейсов в один виртуальный, что позволяет обеспечить большую пропускную способность или 
отказоустойчивость в случае повреждения кабеля.  

Драйвер Linux Team предоставляет альтернативу Bonding. Основное отличие состоит в том, что часть ядра драйвера Team содержит только необходимый код, а остальная часть кода (проверка ссылок, реализация LACP, принятие решений и т. Д.) Выполняется в пользовательском пространстве как часть демона teamd.
  
**Режимы работы Bonding**  
**mode=0** (balance-rr)  
При этом методе объединения трафик распределяется по принципу «карусели»: пакеты по очереди направляются на сетевые карты объединённого интерфейса. Например, если у нас есть физические интерфейсы eth0, eth1, and eth2, объединенные в bond0, первый пакет будет отправляться через eth0, второй — через eth1, третий — через eth2, а четвертый снова через eth0 и т.д.

**mode=1** (active-backup)  
Когда используется этот метод, активен только один физический интерфейс, а остальные работают как резервные на случай отказа основного.

**mode=2** (balance-xor)  
В данном случае объединенный интерфейс определяет, через какую физическую сетевую карту отправить пакеты, в зависимости от MAC-адресов источника и получателя.

**mode=3** (broadcast)  
Широковещательный режим, все пакеты отправляются через каждый интерфейс. Имеет ограниченное применение, но обеспечивает значительную отказоустойчивость.

**mode=4** (802.3ad)  
Особый режим объединения. Для него требуется специально настраивать коммутатор, к которому подключен объединенный интерфейс. Реализует стандарты объединения каналов IEEE и обеспечивает как увеличение пропускной способности, так и отказоустойчивость.

**mode=5** (balance-tlb)  
Распределение нагрузки при передаче. Входящий трафик обрабатывается в обычном режиме, а при передаче интерфейс определяется на основе данных о загруженности.

**mode=6** (balance-alb)  
Адаптивное распределение нагрузки. Аналогично предыдущему режиму, но с возможностью балансировать также входящую нагрузку.

_Пример конфига:_  
```commandline
$ sudo vi /etc/network/interfaces
# The primary network interface
auto bond0
iface bond0 inet static
    address 192.168.1.150
    netmask 255.255.255.0    
    gateway 192.168.1.1
    dns-nameservers 192.168.1.1 8.8.8.8
    dns-search domain.local
        slaves eth0 eth1
        bond_mode 0
        bond-miimon 100
        bond_downdelay 200
        bound_updelay 200
```

Похожие режимы у **team**:

**broadcast**: передает данные через все порты  
**roundrobin**: передает данные через все порты по очереди  
**activebackup**: передает данные через один активный порт, остальные в запасе  
**loadbalance**: передает данные через все порты с допустимой нагрузкой (Berkeley Packet Filter, BPF)  
**random**: передает данные через порт, выбранный случайным образом  
**lacp**: использует протокол 802.3ad, LACP.  


### 5. Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.
Воспользовавшись калькулятором получим 6 адерсов доступных нам для назначения хостам: 
```commandline
vagrant@front:~$ ipcalc 192.168.0.1/29
Address:   192.168.0.1          11000000.10101000.00000000.00000 001
Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111
=>
Network:   192.168.0.0/29       11000000.10101000.00000000.00000 000
HostMin:   192.168.0.1          11000000.10101000.00000000.00000 001
HostMax:   192.168.0.6          11000000.10101000.00000000.00000 110
Broadcast: 192.168.0.7          11000000.10101000.00000000.00000 111
Hosts/Net: 6                     Class C, Private Internet
```
[Статья по расчету с примерами на листочке](https://corpadmin.pp.ua/blog/internet/post/162-raschet-setey-vruchnuyu)  


Количесво доступных 29 подсетей  
Если  в лоб прикинуть:  
256/8=**32**  
256(адресов в 24 подсети)/8 (адресов в 29 подсети)=32 (кол-во возможных подсетей)   
Или по науке:  
/24 -префикс сети или сетевая маска в двоичном написании:  
11111111.11111111.11111111.00000000  
/29 - префикс сети или сетевая маска в двоичном написании:  
11111111.11111111.11111111.11111000  
мы позаимсвовали у 24 подсети из 4 октета 5 битов (считаем или ненулевые биты в октете или 29-24=5)  
Таким образом, кол-во возможных подсетей: 2 в степени 5  =32  

Примеры 29 подсетей в деапазоне 10.10.10.0/24:  
10.10.10.8/29  
10.10.10.16/29  
10.10.10.24/29  
10.10.10.32/29  
...  

### 6. Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.
```
100.64.0.0/26  
100.64.0.64/26  
```
### 7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?
```commandline
vagrant@front:~$ sudo apt-get install net-tools  
vagrant@front:~$ arp
Address                  HWtype  HWaddress           Flags Mask            Iface
_gateway                 ether   52:54:00:12:35:02   C                     eth0
10.0.2.3                 ether   52:54:00:12:35:03   C                     eth0


ip link set arp off dev eth0  
arp -i eth1 -d 10.0.0.1  
```
